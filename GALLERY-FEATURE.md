# Галерея фотографий в профиле

## Обзор функциональности

Добавлена возможность загрузки до 20 фотографий в галерею профиля эксперта с сохранением на сервере.

## Реализованные компоненты

### 1. База данных
**Файл:** `CREATE-GALLERY-TABLE.sql`

```sql
CREATE TABLE IF NOT EXISTS profile_gallery (
  id SERIAL PRIMARY KEY,
  user_id INTEGER NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  image_url VARCHAR(500) NOT NULL,
  image_name VARCHAR(255),
  image_size INTEGER,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 2. Backend API
**Файл:** `backend/src/routes/gallery.ts`

#### Эндпоинты:
- `GET /api/gallery` - получить галерею пользователя
- `POST /api/gallery/upload` - загрузить изображение
- `DELETE /api/gallery/:id` - удалить изображение
- `GET /api/gallery/count` - получить количество изображений

#### Особенности:
- Ограничение: максимум 20 фотографий
- Размер файла: до 10MB на изображение
- Поддерживаемые форматы: jpeg, jpg, png, gif, webp
- Автоматическое удаление файлов при удалении записи

### 3. Frontend компонент
**Файл:** `frontend/src/components/ProfileGallery.tsx`

#### Функциональность:
- Загрузка фотографий с drag & drop
- Превью изображений в модальном окне
- Удаление фотографий с подтверждением
- Отображение размера файла
- Счетчик фотографий (текущее/максимальное)
- Адаптивная сетка (responsive grid)

#### Интерфейс:
- Кнопка "Добавить фото" (только для владельца)
- Сетка фотографий с превью
- Кнопки просмотра и удаления
- Модальное окно для полноразмерного просмотра
- Предупреждение при достижении лимита

### 4. Интеграция в профили

#### В собственном профиле (`ProfilePage.tsx`):
- Галерея отображается между основной информацией и услугами
- Полный доступ к управлению (загрузка/удаление)

#### В публичном профиле (`ExpertProfilePage.tsx`):
- Галерея отображается между тематиками и услугами
- Только просмотр для других пользователей
- Полный доступ для владельца профиля

## Технические детали

### Структура файлов на сервере:
```
uploads/
└── gallery/
    ├── gallery-1234567890-123456789.jpg
    ├── gallery-1234567891-123456789.png
    └── ...
```

### API запросы:

#### Загрузка изображения:
```javascript
const formData = new FormData();
formData.append('image', file);
const response = await api.post('/gallery/upload', formData, {
  headers: { 'Content-Type': 'multipart/form-data' }
});
```

#### Получение галереи:
```javascript
const response = await api.get('/gallery');
const images = response.data;
```

#### Удаление изображения:
```javascript
await api.delete(`/gallery/${imageId}`);
```

### Ограничения:
- **Максимум фотографий:** 20
- **Размер файла:** 10MB на изображение
- **Форматы:** jpeg, jpg, png, gif, webp
- **Авторизация:** только для зарегистрированных пользователей

## Пользовательский опыт

### Для владельца профиля:
1. **Загрузка:** Drag & drop или кнопка "Добавить фото"
2. **Управление:** Просмотр, удаление фотографий
3. **Контроль:** Счетчик фотографий, предупреждения о лимите
4. **Организация:** Фотографии сортируются по дате загрузки (новые сверху)

### Для посетителей:
1. **Просмотр:** Галерея с превью фотографий
2. **Детали:** Полноразмерный просмотр в модальном окне
3. **Информация:** Название и размер файла

## Безопасность

- Проверка авторизации на всех эндпоинтах
- Валидация типов файлов
- Ограничение размера файлов
- Проверка владельца при удалении
- Автоматическая очистка файлов при удалении записей

## Производительность

- Оптимизированные изображения (до 10MB)
- Адаптивная сетка для разных экранов
- Ленивая загрузка превью
- Эффективное управление состоянием

## Совместимость

- Работает во всех современных браузерах
- Поддержка мобильных устройств
- Адаптивный дизайн
- Совместимость с существующей системой авторизации
